<!--
Copyright 2022 ODK Central Developers
See the NOTICE file at the top-level directory of this distribution and at
https://github.com/getodk/central-frontend/blob/master/NOTICE.

This file is part of ODK Central. It is subject to the license terms in
the LICENSE file found in the top-level directory of this distribution and at
https://www.apache.org/licenses/LICENSE-2.0. No part of ODK Central,
including this file, may be copied, modified, propagated, or distributed
except according to the terms contained in the LICENSE file.
-->
<template>
  <div id="dataset-list">
    <page-section>
      <template #heading>
        <span>{{ $t('resource.entityLists') }}</span>
        <button v-if="project.dataExists && project.permits('dataset.create')"
          id="dataset-list-new-button" type="button" class="btn btn-primary"
          @click="newDatasetModal.show()">
          <span class="icon-plus-circle"></span>{{ $t('new') }}
        </button>
      </template>
    </page-section>
    <div class="page-body-heading">
      <p>{{ $t('heading[0]') }}</p>
      <p>
        <span>{{ $t('heading[1]') }}</span>
        <sentence-separator/>
        <i18n-t keypath="moreInfo.clickHere.full">
          <template #clickHere>
            <doc-link to="central-entities">{{ $t('moreInfo.clickHere.clickHere') }}</doc-link>
          </template>
        </i18n-t>
      </p>
    </div>
    <dataset-table/>
    <loading :state="datasets.initiallyLoading"/>
    <dataset-new v-bind="newDatasetModal" @hide="newDatasetModal.hide()" @success="afterCreateDataset"/>
  </div>
</template>

<script setup>
import { useRouter } from 'vue-router';
import DatasetNew from './new.vue';
import DatasetTable from './table.vue';
import DocLink from '../doc-link.vue';
import Loading from '../loading.vue';
import PageSection from '../page/section.vue';
import SentenceSeparator from '../sentence-separator.vue';

import useRoutes from '../../composables/routes';
import { apiPaths } from '../../util/request';
import { modalData } from '../../util/reactivity';
import { noop } from '../../util/util';
import { useRequestData } from '../../request-data';

defineOptions({
  name: 'DatasetList'
});
const props = defineProps({
  projectId: {
    type: String,
    required: true
  }
});

const { project, datasets } = useRequestData();
const { datasetPath } = useRoutes();
const router = useRouter();

datasets.request({
  url: apiPaths.datasets(props.projectId),
  extended: true,
  resend: false
}).catch(noop);

const newDatasetModal = modalData();

const afterCreateDataset = async (dataset) => {
  newDatasetModal.hide();
  await router.push(datasetPath(props.projectId, dataset.name));
  // Increment the count so that if the user returns to a project page, they
  // will see the new count.
  project.datasets += 1;
};
</script>

<i18n lang="json5">
  {
    "en": {
      "heading": [
        // A brief introduction to Entities shown above Entity Lists for the current Project
        "Entities let you share information between Forms so you can collect longitudinal data, manage cases over time, and represent other workflows with multiple steps.",
        "Entities are created through form design and can be attached to any Form."
      ],
      // This is the text of a button that is used to create a new Entity List.
      // It is shown next to a heading whose text is "Entity Lists".
      "new": "New"
    }
  }
</i18n>

<!-- Autogenerated by destructure.js -->
<i18n>
{
  "cs": {
    "heading": [
      "Entity umožňují sdílet informace mezi formuláři, takže můžete shromažďovat longitudinální data, spravovat případy v čase a reprezentovat další pracovní postupy s více kroky.",
      "Entity se vytvářejí prostřednictvím návrhu formuláře a lze je připojit k libovolnému formuláři."
    ],
    "new": "Nový"
  },
  "de": {
    "heading": [
      "Entitäten ermöglichen es Ihnen, Informationen zwischen Formularen zu teilen, sodass Sie longitudinale Daten sammeln, Fälle im Laufe der Zeit verwalten und andere Arbeitsabläufe mit mehreren Schritten darstellen können.",
      "Entitäten werden durch Formulardesign erstellt und können jedem Formular angefügt werden."
    ],
    "new": "Neu"
  },
  "es": {
    "heading": [
      "Las entidades le permiten compartir información entre formularios para que pueda recopilar datos longitudinales, gestionar casos a lo largo del tiempo y representar otros flujos de trabajo con varios pasos.",
      "Las entidades se crean mediante el diseño del formulario y pueden adjuntarse a cualquier formulario."
    ],
    "new": "Nueva"
  },
  "fr": {
    "heading": [
      "Les entités vous permettent de partager de l'information entre vos formulaires. Vous pouvez ainsi collecter des données longitudinales, suivre des cas dans le temps, et créer d'autres processus à multiples étapes.",
      "Les entités sont créées dans vos définitions de formulaires et peuvent être jointes à n'importe quel formulaire."
    ],
    "new": "Nouvelle"
  },
  "it": {
    "heading": [
      "Le entità consentono di condividere le informazioni tra i formulari per raccogliere dati longitudinali, gestire i casi nel tempo e rappresentare altri flussi di lavoro con più passaggi.",
      "Le entità vengono create attraverso la progettazione dei formulari e possono essere allegate a qualsiasi formulario."
    ],
    "new": "Nuova"
  },
  "pt": {
    "heading": [
      "As Entidades permitem que você compartilhe informações entre Formulários para que você possa coletar dados longitudinais, gerenciar casos ao longo do tempo e representar outros fluxos de trabalho com várias etapas.",
      "As Entidades são criadas por meio do design do formulário e podem ser anexadas a qualquer Formulário."
    ],
    "new": "Nova"
  },
  "sw": {
    "heading": [
      "Huluki hukuruhusu kushiriki maelezo kati ya Fomu ili uweze kukusanya data ya longitudinal, kudhibiti matukio baada ya muda, na kuwakilisha utendakazi mwingine kwa hatua nyingi.",
      "Mashirika huundwa kupitia muundo wa fomu na yanaweza kuambatishwa kwa Fomu yoyote."
    ]
  },
  "zh-Hant": {
    "heading": [
      "實體清單允許您在表單之間共用資訊，以便收集縱向資料、隨時間管理案例，並透過多個步驟表示其他工作流程。",
      "實體是透過表單設計建立的，可以附加到任何表單。"
    ],
    "new": "新增"
  }
}
</i18n>
