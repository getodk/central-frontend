<!--
Copyright 2024 ODK Central Developers
See the NOTICE file at the top-level directory of this distribution and at
https://github.com/getodk/central-frontend/blob/master/NOTICE.

This file is part of ODK Central. It is subject to the license terms in
the LICENSE file found in the top-level directory of this distribution and at
https://www.apache.org/licenses/LICENSE-2.0. No part of ODK Central,
including this file, may be copied, modified, propagated, or distributed
except according to the terms contained in the LICENSE file.
-->
<template>
  <qr-panel class="form-draft-qr-panel">
    <template #title>{{ $t('title') }}</template>
    <template #body>
      <div class="clearfix">
        <collect-qr v-if="formDraft.dataExists" :settings="settings"
        error-correction-level="Q" :cell-size="3" draft/>
        <i18n-t keypath="introduction.full" tag="p">
          <template #temporaryCode>
            <strong>{{ $t('introduction.temporaryCode') }}</strong>
          </template>
        </i18n-t>
        <p>{{ $t('stopsWorking') }}</p>
        <p>{{ $t('instructions') }}</p>
        <i18n-t keypath="codesForUsers.full" tag="p">
          <template #appUsers>
            <router-link :to="projectPath('app-users')">
              {{ $t('codesForUsers.appUsers') }}
            </router-link>
          </template>
        </i18n-t>
      </div>
    </template>
  </qr-panel>
</template>

<script setup>
import { computed, inject } from 'vue';
import { useI18n } from 'vue-i18n';

import CollectQr from '../collect-qr.vue';
import QrPanel from '../qr-panel.vue';

import useRoutes from '../../composables/routes';
import { apiPaths } from '../../util/request';
import { useRequestData } from '../../request-data';

defineOptions({
  name: 'FormDraftQrPanel'
});

const { resourceView } = useRequestData();
const formDraft = resourceView('formDraft', (data) => data.get());

const { t } = useI18n();
const projectId = inject('projectId');
const xmlFormId = inject('xmlFormId');
const settings = computed(() => {
  const { draftToken } = formDraft;
  const url = apiPaths.serverUrlForFormDraft(draftToken, projectId, xmlFormId);
  return {
    general: {
      server_url: `${window.location.origin}${url}`,
      form_update_mode: 'match_exactly',
      autosend: 'wifi_and_cellular'
    },
    project: {
      name: t('collectProjectName', { name: formDraft.nameOrId }),
      icon: 'ğŸ“'
    },
    // Collect requires the settings to have an `admin` property.
    admin: {}
  };
});

const { projectPath } = useRoutes();
</script>

<i18n lang="json5">
{
  "en": {
    // This is the title at the top of a pop-up. "Code" refers to a QR code.
    "title": "Testing Code",
    // @transifexKey component.FormDraftTesting.collectProjectName
    // This text will be shown in ODK Collect when testing a Draft Form. {name}
    // is the title of the Draft Form.
    "collectProjectName": "[Draft] {name}",
    "introduction": {
      // This is shown next to a QR code.
      "full": "This is a {temporaryCode}.",
      // "Code" refers to a QR code.
      "temporaryCode": "Temporary Testing Code"
    },
    // "It" refers to a temporary testing code.
    "stopsWorking": "It will stop working when you publish this Draft.",
    // The table is a table of test Submissions.
    "instructions": "Scan this QR code to configure Collect on a device for testing and submitting data to this test table.",
    "codesForUsers": {
      // "Codes" refers to "QR codes".
      "full": "To create codes to distribute to users, please see the {appUsers} page.",
      "appUsers": "App Users"
    }
  }
}
</i18n>

<!-- Autogenerated by destructure.js -->
<i18n>
{
  "cs": {
    "collectProjectName": "[NÃ¡vrh] {name}"
  },
  "de": {
    "title": "Test-Code",
    "introduction": {
      "full": "Das ist ein {temporaryCode}.",
      "temporaryCode": "VorlÃ¤ufiger Testcode"
    },
    "stopsWorking": "Wenn Sie diesen Entwurf verÃ¶ffentlichen, funktioniert er nicht mehr.",
    "instructions": "Scannen Sie diesen QR-Code, um Collect auf einem GerÃ¤t fÃ¼r Tests zu konfigurieren und Daten an diese Testtabelle zu Ã¼bermitteln.",
    "codesForUsers": {
      "full": "Um Codes zur Verteilung an Benutzer zu erstellen, besuchen Sie bitte die {appUsers} Seite",
      "appUsers": "App-Benutzer"
    },
    "collectProjectName": "[Entwurf] {name}"
  },
  "es": {
    "title": "CÃ³digo de prueba",
    "introduction": {
      "full": "Este es un {temporaryCode}.",
      "temporaryCode": "CÃ³digo de prueba temporal"
    },
    "stopsWorking": "DejarÃ¡ de funcionar cuando publiques este borrador.",
    "instructions": "Escanee este cÃ³digo QR para configurar Collect en un dispositivo para realizar pruebas y enviar datos a esta tabla de pruebas.",
    "codesForUsers": {
      "full": "Para crear cÃ³digos para distribuir a los usuarios, consulte la pÃ¡gina {appUsers}.",
      "appUsers": "Usuarios de AplicaciÃ³n"
    },
    "collectProjectName": "borrador {name}"
  },
  "fr": {
    "title": "Code de Test",
    "introduction": {
      "full": "Ceci est un {temporaryCode}",
      "temporaryCode": "Code de Test Temporaire"
    },
    "stopsWorking": "Il cessera de fonctionner quand vous publierez cette Ã©bauche.",
    "instructions": "Scannez ce QR code pour configurer Collect sur un appareil pour tester et soumettre des donnÃ©es Ã  cette table de test.",
    "codesForUsers": {
      "full": "Pour crÃ©er des codes Ã  distribuer aux utilisateurs, merci de visiter la page {appUsers}.",
      "appUsers": "Utilisateurs mobiles"
    },
    "collectProjectName": "[Brouillon] {name}"
  },
  "id": {
    "collectProjectName": "[Draf]{name}"
  },
  "it": {
    "title": "Codice di test.",
    "introduction": {
      "full": "Questo Ã¨ un {temporaryCode}.",
      "temporaryCode": "Codice di test temporaneo"
    },
    "stopsWorking": "SmetterÃ  di funzionare quando pubblicherete questa bozza.",
    "instructions": "Scansionare questo codice QR per configurare Collect su un dispositivo per i test e inviare i dati a questa tabella di test.",
    "codesForUsers": {
      "full": "Per creare codici da distribuire agli utenti, consultare la pagina {appUsers}.",
      "appUsers": "Utenti dell'applicazione"
    },
    "collectProjectName": "[Draft] {name}"
  },
  "ja": {
    "collectProjectName": "[ä¸‹æ›¸ã] {name}"
  },
  "pt": {
    "title": "CÃ³digo para teste",
    "introduction": {
      "full": "Este Ã© um {temporaryCode}",
      "temporaryCode": "CÃ³digo para teste temporÃ¡rio"
    },
    "stopsWorking": "Vai parar de funcionar quando vocÃª publicar este Rascunho.",
    "instructions": "Escaneie o QR code para configurar o Collect num aparelho para testar e enviar dados a esta tabela de teste.",
    "codesForUsers": {
      "full": "Para criar cÃ³digos para distribuir aos usuÃ¡rios, veja a pÃ¡gina {appUsers}.",
      "appUsers": "UsuÃ¡rios de App"
    },
    "collectProjectName": "[Rascunho] {name}"
  },
  "sw": {
    "collectProjectName": "[Rasimu] {name}"
  },
  "zh": {
    "title": "æµ‹è¯•ä»£ç ",
    "introduction": {
      "full": "è¿™æ˜¯ä¸€ä¸ª{temporaryCode}ã€‚",
      "temporaryCode": "ä¸´æ—¶ä»£ç ï¼ˆæµ‹è¯•ç”¨ï¼‰"
    },
    "stopsWorking": "å‘å¸ƒæ­¤è‰ç¨¿åï¼Œæµ‹è¯•ä»£ç å°†å¤±æ•ˆã€‚",
    "instructions": "æ‰«ææ­¤äºŒç»´ç å³å¯åœ¨è®¾å¤‡ä¸Šé…ç½®Collectï¼Œç”¨äºå‘æ­¤æµ‹è¯•è¡¨æ ¼æäº¤æµ‹è¯•æ•°æ®ã€‚",
    "codesForUsers": {
      "full": "å¦‚éœ€åˆ›å»ºåˆ†å‘ç»™ç”¨æˆ·çš„äºŒç»´ç ï¼Œè¯·å‰å¾€{appUsers}é¡µé¢ã€‚",
      "appUsers": "APPç”¨æˆ·"
    },
    "collectProjectName": "[è‰ç¨¿] {name}"
  },
  "zh-Hant": {
    "title": "æ¸¬è©¦ç¨‹å¼ç¢¼",
    "introduction": {
      "full": "é€™æ˜¯ä¸€å€‹ {temporaryCode}.",
      "temporaryCode": "è‡¨æ™‚æ¸¬è©¦ç¨‹å¼ç¢¼"
    },
    "stopsWorking": "ç•¶æ‚¨ç™¼å¸ƒæ­¤è‰ç¨¿æ™‚ï¼Œå®ƒå°‡åœæ­¢å·¥ä½œã€‚",
    "instructions": "æƒææ­¤äºŒç¶­ç¢¼å¯åœ¨è£ç½®ä¸Šè¨­å®š Collect ä»¥é€²è¡Œæ¸¬è©¦ä¸¦å°‡è³‡æ–™æäº¤è‡³æ­¤æ¸¬è©¦è¡¨ã€‚",
    "codesForUsers": {
      "full": "è‹¥è¦å»ºç«‹ç¨‹å¼ç¢¼ä»¥åˆ†ç™¼çµ¦ç”¨æˆ¶ï¼Œè«‹åƒé–± {appUsers} é é¢ã€‚",
      "appUsers": "æ‡‰ç”¨ç¨‹å¼ç”¨æˆ¶"
    },
    "collectProjectName": "[è‰ç¨¿] {name}"
  }
}
</i18n>
